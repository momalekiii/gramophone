<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ژانرهای موسیقی فارسی</title>
<style>
body { margin:0; font-family:sans-serif; display:flex; justify-content:center; align-items:center; min-height:100vh; background:#fdfdfd; }
.container { display:flex; flex-wrap:wrap; justify-content:center; gap:20px; max-width:90%; }
.card { background:#fff; border:1px solid #ddd; border-radius:12px; padding:12px; text-align:center; cursor:pointer; min-width:100px; flex:1 1 120px; display:flex; flex-direction:column; align-items:center; gap:8px; transition: transform 0.18s ease; box-shadow:0 4px 8px rgba(0,0,0,0.06); }
.card:hover { transform:translateY(-6px); }
.avatar { width:80px; height:80px; border-radius:50%; object-fit:cover; border:2px solid #eee; }
.genre-title { font-weight:600; padding:8px 0; width:100%; text-align:center }
@media (max-width:600px){ body{ padding:20px; } .container{ flex-direction:column; align-items:center; } .card{ width:100%; max-width:360px; } }
.back-btn{ margin-top:12px; background:#eee; border:none; border-radius:8px; padding:8px 14px; cursor:pointer; }
.song-row{ display:flex; flex-direction:column; gap:8px; align-items:center; width:100%; justify-content:center }
.player-overlay{ position:fixed; inset:0; display:none; align-items:center; justify-content:center; background:rgba(0,0,0,0.6); z-index:9999; }
.player-box{ width:90%; max-width:640px; background:#fff; padding:12px; border-radius:8px; color:#000; }
.close-player{ margin-top:8px; display:block; width:100%; }
audio{ width:100%; }
.song-links a { margin:0 4px; text-decoration:none; color:#0073e6; font-size:0.9rem; }
</style>
</head>
<body>
<div class="container" id="main-container">
<div class="card" onclick="fetchSingers('پاپ')">پاپ</div>
<div class="card" onclick="fetchSingers('سنتی')">سنتی</div>
<div class="card" onclick="fetchSingers('رپ')">رپ</div>
<div class="card" onclick="fetchSingers('راک')">راک</div>
</div>
<div id="player-overlay" class="player-overlay">
<div class="player-box" id="player-box">
<div id="player-content"></div>
<button id="close-player" class="close-player">بستن</button>
</div>
</div>
<script>
const container = document.getElementById('main-container');
const overlay = document.getElementById('player-overlay');
const playerContent = document.getElementById('player-content');
const closePlayerBtn = document.getElementById('close-player');
const singersByGenre = { 'پاپ': [], 'سنتی': [], 'رپ': [], 'راک': [] };
let audioTimeout = null;

async function fetchWikiImage(name){
  try{
    const response = await fetch(`https://fa.wikipedia.org/w/api.php?action=query&titles=${encodeURIComponent(name)}&prop=pageimages&format=json&pithumbsize=300&origin=*`);
    const data = await response.json();
    const pages = data.query.pages;
    for(const key in pages){
      if(pages[key].thumbnail) return pages[key].thumbnail.source;
    }
  }catch(e){ console.log('Wikipedia image error', e); }
  return `https://via.placeholder.com/80x80?text=${encodeURIComponent(name)}`; // fallback
}

async function fetchSingers(genre){
  singersByGenre[genre] = [
    { name:'ابی', links:{spotify:'https://open.spotify.com/artist/1', soundcloud:'https://soundcloud.com/artist1', wikipedia:'https://fa.wikipedia.org/wiki/ابی'} },
    { name:'شادمهر عقیلی', links:{spotify:'https://open.spotify.com/artist/2', soundcloud:'https://soundcloud.com/artist2', wikipedia:'https://fa.wikipedia.org/wiki/شادمهر_عقیلی'} },
    { name:'محسن یگانه', links:{spotify:'https://open.spotify.com/artist/3', soundcloud:'https://soundcloud.com/artist3', wikipedia:'https://fa.wikipedia.org/wiki/محسن_یگانه'} }
  ];
  for(const singer of singersByGenre[genre]){
    singer.img = await fetchWikiImage(singer.name);
  }
  showSingers(genre);
}

function showSingers(genre){
  container.innerHTML = `<div class="genre-title">${genre}</div>`;
  singersByGenre[genre].forEach(singer=>{
    const div=document.createElement('div'); div.className='card';
    const img=document.createElement('img'); img.className='avatar';
    img.src=singer.img;
    const name=document.createElement('div'); name.innerText=singer.name;
    div.appendChild(img); div.appendChild(name);
    div.onclick=()=>showSongs(singer);
    container.appendChild(div);
  });
  addBackButton();
}

function showSongs(singer){
  container.innerHTML=`<div class="genre-title">${singer.name}</div>`;
  const topSongs=[{title:'نمونه موسیقی', source:'direct', url:'https://archive.org/download/testmp3testfile/test.mp3'}];
  topSongs.forEach(song=>{ container.appendChild(makeSongRow(song)); });
  const linksDiv = document.createElement('div'); linksDiv.className='song-links';
  for(const [key,url] of Object.entries(singer.links)){
    const a = document.createElement('a'); a.href=url; a.target='_blank'; a.innerText=key; linksDiv.appendChild(a);
  }
  container.appendChild(linksDiv);
  addBackButton();
}

function makeSongRow(song){
  const row=document.createElement('div'); row.className='card';
  const title=document.createElement('div'); title.innerText=song.title;
  const previewBtn=document.createElement('button'); previewBtn.innerText='پیش‌نمایش 30s';
  previewBtn.onclick=(e)=>{ e.stopPropagation(); openPreview(song); };
  row.appendChild(title); row.appendChild(previewBtn);
  return row;
}

function addBackButton(){
  const back=document.createElement('button'); back.className='back-btn'; back.innerText='بازگشت'; back.onclick=()=>location.reload();
  container.appendChild(back);
}

function openPreview(song){
  playerContent.innerHTML=''; overlay.style.display='flex';
  if(song.source==='direct' && song.url){
    const audio=document.createElement('audio'); audio.controls=true; audio.autoplay=true; audio.src=song.url;
    playerContent.appendChild(audio);
    clearTimeout(audioTimeout);
    audioTimeout=setTimeout(()=>{ try{ audio.pause(); }catch(e){} closePlayer(); },30000);
  }else{ playerContent.innerText='منبع پیش‌نمایش در دسترس نیست.'; }
}

function closePlayer(){ overlay.style.display='none'; playerContent.innerHTML=''; clearTimeout(audioTimeout); }
closePlayerBtn.onclick=closePlayer;
</script>
</body>
</html>
